# RC 탱크 프로젝트

Bluepad32를 이용한 게임패드 조작 RC 탱크입니다.

## 기능

- **게임패드 연결**: Bluepad32를 통한 블루투스 게임패드 연결
- **트랙 제어**: 좌측 스틱 Y축으로 좌측 트랙, 우측 스틱 Y축으로 우측 트랙 독립 제어
- **터렛 제어**: D-PAD 좌우로 터렛 회전
- **포 마운트 제어**: D-PAD 상하로 포 마운트 각도 조절
- **포신 발사**: A 버튼으로 포신 당기기 (LED 깜빡임 + 효과음 2)
- **기관총 발사**: B 버튼으로 기관총 발사 (LED 점멸 + 효과음 3, 3초간)
- **헤드라이트**: X 버튼으로 헤드라이트 ON/OFF
- **속도 조절**: L1/L2, R1/R2로 좌우 트랙 속도 조절 (EEPROM 저장)
- **효과음**: DFPlayer를 통한 SD카드 효과음 재생

## 하드웨어 연결

### ESP32 핀 연결

| ESP32 핀 | 연결 대상 | 설명 |
|---------|-----------|------|
| GPIO 2  | LED | 포신 발사 시 깜빡임 |
| GPIO 4  | 헤드라이트 LED | 헤드라이트 제어 |
| GPIO 5  | 포 마운트 서보 모터 | 포 마운트 각도 제어 (우측 Y축) |
| GPIO 12 | 터렛 모터 IN1 | DRV8833 터렛 제어 |
| GPIO 13 | 우측 트랙 IN2 | DRV8833 우측 트랙 제어 |
| GPIO 14 | 터렛 모터 IN2 | DRV8833 터렛 제어 |
| GPIO 18 | 포신 서보 모터 | 포신 당기기 제어 (A 버튼) |
| GPIO 25 | 좌측 트랙 IN1 | DRV8833 좌측 트랙 제어 |
| GPIO 26 | 좌측 트랙 IN2 | DRV8833 좌측 트랙 제어 |
| GPIO 27 | 우측 트랙 IN1 | DRV8833 우측 트랙 제어 |
| GPIO 33 | DFPlayer TX | DFPlayer 통신 |
| GPIO 32 | DFPlayer RX | DFPlayer 통신 |

### DRV8833 모터 드라이버 연결

#### 좌측 트랙 (DRV8833 #1)
- AIN1 → GPIO 25
- AIN2 → GPIO 26
- AOUT1 → 좌측 트랙 모터 1
- AOUT2 → 좌측 트랙 모터 2
- VM → 12V 전원
- GND → 공통 접지
- VCC → 3.3V (논리 전원)

#### 우측 트랙 (DRV8833 #1)
- BIN1 → GPIO 27
- BIN2 → GPIO 14
- BOUT1 → 우측 트랙 모터 1
- BOUT2 → 우측 트랙 모터 2

#### 터렛 (DRV8833 #2)
- AIN1 → GPIO 12
- AIN2 → GPIO 13
- AOUT1 → 터렛 모터 +
- AOUT2 → 터렛 모터 -
- VM → 12V 전원
- GND → 공통 접지
- VCC → 3.3V (논리 전원)

### 서보 모터 연결

#### 포 마운트 서보 모터 (각도 조절)
- **신호선**: GPIO 5
- **전원**: 5V
- **접지**: 공통 접지
- **기능**: D-PAD 상하로 포 마운트 각도 조절

#### 포신 서보 모터 (당기기)
- **신호선**: GPIO 18
- **전원**: 5V
- **접지**: 공통 접지
- **기능**: A 버튼으로 포신 당기기

### DFPlayer Mini 연결

- RX → GPIO 33
- TX → GPIO 32
- VCC → 5V
- GND → 공통 접지
- SPK_1, SPK_2 → 스피커

## SD카드 설정

SD카드에 다음 파일들을 저장하세요:

```
sdcard/
├── 0001.mp3  (효과음 1 - 대기 시 반복 재생)
├── 0002.mp3  (효과음 2 - 포신 발사 시 재생)
├── 0003.mp3  (효과음 3 - 기관총 발사 시 재생)
└── 0004.mp3  (효과음 4 - 기타)
```

## 게임패드 조작법

### 기본 조작
- **좌측 스틱 Y축**: 좌측 트랙 전후진 제어
- **우측 스틱 Y축**: 우측 트랙 전후진 제어
- **D-PAD 좌우**: 터렛 좌우 회전
- **D-PAD 상하**: 포 마운트 상하 각도 조절

### 버튼 조작
- **A 버튼**: 포신 당기기 (LED 깜빡임 + 효과음 2 재생, 500ms)
- **B 버튼**: 기관총 발사 (LED 점멸 + 효과음 3 재생, 3초간)
- **X 버튼**: 헤드라이트 ON/OFF 토글

### 속도 조절
- **L1**: 좌측 트랙 속도 증가 (+10)
- **L2**: 좌측 트랙 속도 감소 (-10)
- **R1**: 우측 트랙 속도 증가 (+10)
- **R2**: 우측 트랙 속도 감소 (-10)

*속도 설정은 EEPROM에 자동 저장되어 다음 시작 시에도 유지됩니다.*

### LED 동작
- **포신 발사 시**: LED 100ms 간격으로 깜빡임 (500ms 동안)
- **기관총 발사 시**: LED 500ms 간격으로 점멸 (3초간)

## 컴파일 및 업로드

1. PlatformIO IDE에서 프로젝트를 열기
2. 필요한 라이브러리들이 자동으로 설치됩니다
3. ESP32 보드를 연결하고 업로드
4. 시리얼 모니터로 초기화 과정 확인

## 초기화 과정

1. ESP32 부팅
2. EEPROM에서 속도 설정 로드
3. DFPlayer 초기화 및 효과음 1 재생 시작
4. Bluepad32 초기화
5. 게임패드 연결 대기

## 게임패드 연결

1. ESP32 부팅 후 블루투스 페어링 모드 진입
2. 게임패드에서 블루투스 설정으로 ESP32 연결
3. 연결 성공 시 효과음 1 재생 중단
4. 게임패드 조작 가능

## 문제 해결

### 게임패드가 연결되지 않는 경우
- ESP32 재부팅 후 다시 시도
- 게임패드 페어링 정보 초기화 후 재연결

### 모터가 작동하지 않는 경우
- 전원 공급 확인 (12V)
- DRV8833 연결 확인
- PWM 채널 설정 확인

### 효과음이 나오지 않는 경우
- SD카드 파일명 확인 (0001.mp3, 0002.mp3 등)
- DFPlayer 연결 확인 (GPIO 32, 33)
- 볼륨 설정 확인 (코드에서 20으로 설정)

### 서보 모터가 작동하지 않는 경우
- 서보 모터 전원 공급 확인 (5V)
- 서보 신호선 연결 확인 (GPIO 5, GPIO 18)
- ESP32Servo 라이브러리 설치 확인

## 라이센스

이 프로젝트는 MIT 라이센스 하에 배포됩니다.
